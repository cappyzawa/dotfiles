name: CI
on: push
jobs:
  setUP:
    name: Set Up
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macOS-latest]
    runs-on: ${{ matrix.os }}
    steps:
    - name: install-zsh
      run: |
        zsh_version="5.7.1"
        if ! [[ -d /tmp ]]; then
          sudo mkdir /tmp
        fi
        export LOCAL="$(mktemp --directory --tmpdir=${TMPDIR:/tmp} local.bin.XXXXXX)"
        curl -L http://sourceforge.net/projects/zsh/files/zsh/${zsh_version}/zsh-${zsh_version}.tar.xz/download | tar Jxv

        cd zsh-${zsh_version}
        ./configure --prefix=${LOCAL} --with-tcsetpgrp
        sudo make
        sudo make install
        cd -
        sudo cp ${LOCAL}/bin/zsh /usr/local/bin/zsh
        which zsh
    - name: setUP
      run: |
        curl -sL https://raw.githubusercontent.com/cappyzawa/dotfiles/master/etc/install | bash
    - name: deploy-links
      run: |
        cd ~/.dotfiles
        make deploy
    - name: source-zshrc
      run: |
        zsh -c "source ~/.zshrc"

  vim:
    needs: [setUP]
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macOS-latest]
    runs-on: ${{ matrix.os }}
    steps:
    - name: vim PlugInstall
      run: nvim +PlugUpdate +qall
