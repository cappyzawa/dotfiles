name: CI
on: push
jobs:
  setUP:
    name: Set Up
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macOS-latest]
    runs-on: ${{ matrix.os }}
    steps:
    - name: install-zsh
      run: |
        zsh_version="5.7.1"
        LOCAL="/tmp/zcptemp"
        if ! [[ -d /tmp ]]; then
          sudo mkdir /tmp
        fi
        sudo mkdir ${LOCAL}
        curl -L http://sourceforge.net/projects/zsh/files/zsh/${zsh_version}/zsh-${zsh_version}.tar.xz/download | tar Jxv

        cd zsh-${zsh_version}
        ./configure --prefix=${LOCAL} --with-tcsetpgrp
        sudo make
        sudo make install
        cd -
        sudo cp ${LOCAL}/bin/zsh /usr/local/bin/zsh
    - name: setUP
      run: |
        curl -sL https://raw.githubusercontent.com/cappyzawa/dotfiles/master/etc/install | bash
    - name: deploy-links
      run: |
        cd ~/.dotfiles
        make deploy
        cd -
    - name: source profile
      run: |
        zsh -c "source ~/.zshenv"
        zsh -c "source ~/.zshrc"
        sleep 60
        echo "1"
        sleep 60
        echo "2"
        sleep 60
        echo "3"
        echo "done"
    - name: vim PlugInstall
      run: |
        zsh -c "nvim +PlugInstall +qall"
